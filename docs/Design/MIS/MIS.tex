\documentclass[12pt, titlepage]{article}

\usepackage{amsmath, mathtools}

% \usepackage[round]{natbib}
\usepackage[numbers,square]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
\usepackage{fullpage}

\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

\usepackage{array}

\externaldocument{../../SRS/SRS}
\externaldocument{../MG/MG}

\input{../../Comments}
\input{../../Common}

\newcommand{\mref}[1]{M\ref{#1}}
\newcommand{\mrefp}[1]{(\mref{#1})}
\newcommand{\mreff}[1]{Module \mrefp{#1}}

\newcommand{\msref}[1]{Module Specification (\ref{#1})}

\newcommand{\code}[1]{\texttt{#1}}

\begin{document}

\title{Module Interface Specification for \progname{}}

\author{\authname}

\date{\today}

\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{3cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
2023/03/18 & 0.1.0 & Creation\\
           & 0.1.1 & Update module hierarchy\\
2023/03/19 & 0.1.2 & Add in module specifications\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

\renewcommand{\arraystretch}{1.2}
\begin{tabular}{l l} 
  \toprule		
  \textbf{symbol} & \textbf{description}\\
  \midrule 
  HID & Human Interface Device\\
  URL & Uniform Resource Locator\\
  imageDrawingObject & a geometry where the fill is an image\\
  \bottomrule
\end{tabular}\\

~\newline
\noindent See the SRS \cite{SRS} and MG \cite{MG} Documentation for additional items.

\newpage

\tableofcontents

\newpage

\pagenumbering{arabic}

\section{Introduction}

The following document details the Module Interface Specifications for
\progname{} (\prognamelong{}).

Complementary documents include the System Requirement Specifications
and Module Guide.  The full documentation and implementation can be
found at \url{https://github.com/joedf/CAS741_w23}.

\section{Notation}

The structure of the MIS for modules comes from \citet{HoffmanAndStrooper1995},
with the addition that template modules have been adapted from
\cite{GhezziEtAl2003}.  The mathematical notation comes from Chapter 3 of
\citet{HoffmanAndStrooper1995}.  For instance, the symbol := is used for a
multiple assignment statement and conditional rules follow the form $(c_1
\Rightarrow r_1 | c_2 \Rightarrow r_2 | ... | c_n \Rightarrow r_n )$.

The following table summarizes the primitive data types used by \progname. 

\begin{center}
\renewcommand{\arraystretch}{1.2}
\noindent 
\begin{tabular}{l l p{7.5cm}} 
\toprule 
\textbf{Data Type} & \textbf{Notation} & \textbf{Description}\\ 
\midrule
integer & $\mathbb{Z}$ & a number without a fractional component in (-$\infty$, $\infty$) \\
positive integer & $\mathbb{Z}_+$ & a positive integer ($\mathbb{Z}$) in (0, $\infty$) \\
unsigned 8-bit integer & $\mathbb{U}$ & a number without a fractional component in (0, 255)\\
natural number & $\mathbb{N}$ & a number without a fractional component in [1, $\infty$) \\
real & $\mathbb{R}$ & any number in (-$\infty$, $\infty$)\\
positive real & $\mathbb{R}_+$ & any real number in (0, $\infty$)\\
ratio & $\mathbb{A}$ & any real number in (0, 1)\\
imageData \cite{MDN_imagedata} & $\mathbb{I}_{w,h}$ & \code{data}: a one dimensional array of positive integers from
  0 to 255 in RGBA order (pixel components) start from the top left pixel to the
  bottom right pixel with a \code{width}: $\mathbb{Z}_+$ width of $w$
  and \code{height}: $\mathbb{Z}_+$ height of $h$.\\
\bottomrule
\end{tabular} 
\end{center}

\noindent
The specification of \progname \ uses some derived data types: sequences, strings, and
tuples. Sequences are lists filled with elements of the same data type. Strings
are sequences of characters. Tuples contain a list of values, potentially of
different types. In addition, \progname \ uses functions, which
are defined by the data types of their inputs and outputs. Local functions are
described by giving their type signature followed by their specification.

\newpage

\section{Module Decomposition}

The following table is taken directly from the Module Guide \cite{MG} document for this project.

\begin{table}[h!]
\centering
\input{../MG/ModuleHierarchy.tex}
\caption{Module Hierarchy}
\label{TblMH}
\end{table}

~\newpage


% ///////////////////////////////////////////////////////////////////////
% /////////////////////////// START MIS ITEMS ///////////////////////////
% ///////////////////////////////////////////////////////////////////////


\section{MIS of Application Control} \label{MS_control}

\subsection{Module}
\code{main} \mrefp{M_control}

\subsection{Uses}
GUI \msref{MS_GUI}

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
main & - & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None

\subsubsection{Environment Variables}
None

\subsubsection{Assumptions}
\begin{itemize}
  \item The application is run in an HTML5 compliant web browser.
  \item The GUI is running and displayed without issue.
\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent \code{main()}:
\begin{itemize}
\item transition: Initializes the GUI, modifies the state and environment variables of the GUI \msref{MS_GUI}.
\end{itemize}

\subsubsection{Local Functions}
\code{UpdateBaseImage()}: Updates the GUI and propagates a change in the input ground truth
image throughout the application.
\newpage



\section{MIS of Graphical User Interface (GUI)} \label{MS_GUI}

\subsection{Module}
\code{gui} \mrefp{M_GUI}

\subsection{Uses}
Hardware Hiding \mreff{M_HdwHide},
Display Control \mreff{M_dispControl},
Ground Truth Image Input \mreff{M_imgGTInput},
Imaging Parameters Input \mreff{M_params},
Spot Profile Input \mreff{M_inSpotProfile},
Image Export \mreff{M_export},
Information and Metrics Display \mreff{M_infoDisp}

\subsection{Syntax}

\subsubsection{Exported Constants}
\begin{itemize}
  \item \code{G\_BoxSize}: A value ($\mathbb{N}$) describing both the pixel width and height used for each visualization display ``box''.
  \item \code{G\_MATH\_TOFIXED}: Used for display for fixed decimal number length
    rounding (ex. ``4.1234'' at fixed length ``2'' results in ``4.12'').
\end{itemize}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{5cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{gui} & \code{baseImage} & displayReference, & - \\
           &                  & event handlers \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}
\an{Didn't do MIS descriptions of the Input modules because they are essentially just
buttons or text boxes with event handlers. Can be implemented however as long the SRS
value constrains are followed... Or are full descriptions also needed for these?
Not sure if they would add much value than already provided here or just informational noise.
Maybe I can write this as a note here (instead of a comment)?}

\subsubsection{State Variables}
\begin{itemize}
  \item \code{baseImage}: The ground truth image as processed and given by \mref{M_imgGTInput} as $\mathbb{I}_{w,h}$.
  \item \code{resultImage}: A reference to resulting image as processed and given by \mref{M_dispControl} as $\mathbb{I}_{w,h}$.
  \item \code{imageRows}: Rasterization grid rows given by \mref{M_params} as $\mathbb{Z}_+$.
  \item \code{imageCols}: Rasterization grid columns given by \mref{M_params} as $\mathbb{Z}_+$.
  \item \code{imageMag}: Magnification of the subregion as given by \mref{M_params} as $\mathbb{R}_+$.
  \item \code{spotWidth}: The spot's width given by \mref{M_inSpotProfile} as $\mathbb{Z}_+$.
  \item \code{spotHeight}: The spot's height given by \mref{M_inSpotProfile} as $\mathbb{Z}_+$.
  \item \code{spotAngle}: The spot's angle given by \mref{M_inSpotProfile} as $\mathbb{R}$.
\end{itemize}

\subsubsection{Environment Variables}
\begin{itemize}
  \item Keyboard
  \item Mouse
  \item Screen
  \item File System
\end{itemize}

\subsubsection{Assumptions}
\begin{itemize}
  \item The file system is able to read and provide the image file as specified by the user through an OS file-open dialog.
  Otherwise, if the file is not found, denied access, or cancelled, no changes should occur.
  \item The OS and WebBrowser are able to provide basic text or number input user controls with some basic built-in validation,
  and is able to handle events from Human Interface Devices (HIDs such as a mouse, keyboard, or touchscreen).
\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent \code{OnImageLoaded()}:
\begin{itemize}
  \item transition: Sets up user control event handlers (e.g., mouse clicks or drag, button presses, text input change, ...)
    as needed for the user input modules (\mref{M_imgGTInput}, \mref{M_params} and \mref{M_inSpotProfile}),
    initializes the Display \mreff{M_dispControl} and obtains an update function reference for redraws or state changes.
    \an{I am not sure what transition means, couldn't find it as a defined term in the slides. I hope this is right...}
  \item output: 
    \begin{itemize}
      \item \code{doUpdate()}: notifies the Display Control \mreff{M_dispControl} to update / redraw the visualization displays.
      \item \code{updateInfoDisplay()}: notifies the Information Display \mreff{M_infoDisp} to update when needed (such as
      an input value change from the mentioned input modules).
      \item \code{doExport()}: Event handler for the "Export" button press, it calls the Image Export \mreff{M_export}.
    \end{itemize}
\end{itemize}

\subsubsection{Local Functions}
None.

\newpage


\section{MIS of Information and Metrics Display} \label{MS_infoDisp}

\subsection{Module}
\code{infoDisp} \mrefp{M_infoDisp}

\subsection{Uses}
Metrics Calculation \mreff{M_metric}

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{7cm} p{1cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{updateInfo} & \code{textDisplayControl}, \code{baseImage}, & - & - \\
                  & \code{resultImage}, \code{imageMag} \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None.

\subsubsection{Environment Variables}
The decimal length for rounding the number for display as defined by \msref{MS_GUI}.

\subsubsection{Assumptions}
\begin{itemize}
  \item A suitable display control (capable of displaying text and numbers) is constructed
  and displayed in the GUI for use by this module.
\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent \code{updateInfo(textDisplayControl, baseImage, resultImage, imageMag)}:
\begin{itemize}
\item transition: Calls the Metrics Calculation \mreff{M_metric} to compare the given images
  (\code{baseImage} and \code{resultImage}) to get metric value ($\mathbb{R}$).
  The magnification (\code{imageMag}) and metric values are then rounded 
  and pushed as formatted descriptive text to \code{textDisplayControl}.
\end{itemize}

\subsubsection{Local Functions}
None.

\newpage



\section{MIS of Image Export} \label{MS_ImageExport}

\subsection{Module}
\code{imgExport} \mrefp{M_export}

\subsection{Uses}
None

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{export} & \code{resultImage}, \code{outputPath} & ImageFile & \code{InvalidPath} \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None.

\subsubsection{Environment Variables}
The File System.

\subsubsection{Assumptions}
The output location is a valid writable and accessible. 

\subsubsection{Access Routine Semantics}

\noindent \code{export}(resultImage, outputPath):
\begin{itemize}
\item output: an image file representing \code{resultImage} at location \code{outputPath}. 
\item exception: \code{InvalidPath} meaning the location cannot be written to, either because
  the directory is nonexistent, the path contains invalid characters, or inadequate write permissions.
\end{itemize}

\subsubsection{Local Functions}
None

\newpage



\section{MIS of Display Control} \label{MS_dispControl}

\subsection{Module}
\code{dispControl} \mrefp{M_dispControl}

\subsection{Uses} \label{USES_dispControl}
\begin{enumerate}
  \item Rendering \mreff{M_rendering}
  \item Ground Truth Visualization \mreff{M_vizGT}
  \item Subregion Visualization \mreff{M_vizSubregion}
  \item Spot Profile Visualization \mreff{M_vizSpotProfile}
  \item Spot Content Visualization \mreff{M_vizSpotContent}
  \item Spot Signal Visualization \mreff{M_vizSpotSignal}
  \item Spot Layout Visualization \mreff{M_vizSpotLayout}
  \item Sampled Subregion Visualization \mreff{M_vizSampledSub}
  \item Resulting Subregion Visualization \mreff{M_vizResultSub}
  \item Resulting Image Visualization \mreff{M_vizResultImg}
\end{enumerate}

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{Init} & Display controls for 2 to 10 in section \ref{USES_dispControl}
  & a reference to the \code{doUpdate} for each & - \\
\hline
\code{doUpdateAll} & - & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
\begin{itemize}
  \item References to drawing stages/canvases for all the visualization/display modules mentioned
    in section \ref{USES_dispControl}
  \item ... and each corresponding update function references
  \item \code{gtImage}: a reference to the ground truth image data (as provided by \mref{M_imgGTInput}).
  \item \code{subregionImage}: a reference to imageDrawingObject (as provided by \mref{M_vizSubregion}).
\end{itemize}

\subsubsection{Environment Variables}
Display controls as provided by the GUI \mreff{M_GUI}.

\subsubsection{Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent \code{Init()}:
\begin{itemize}
\item transition: Initializes the drawing stages/canvases in each of the Display control (locations)
  as provided by the GUI \mreff{M_GUI} and passes them to each corresponding visualization module.
\item output: a \code{doUpdate} function reference for each of the visualization modules.
\end{itemize}

\noindent \code{doUpdateAll()}:
\begin{itemize}
\item transition: updates all the visualization displays by calling all the corresponding
   \code{doUpdate} function references.
\end{itemize}

\subsubsection{Local Functions}
None

\newpage




\section{MIS of Drawing Stage / Canvas} \label{MS_drawStage}

\subsection{Module}
\code{stage} \mrefp{M_drawStage} 

\subsection{Uses}
None

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{5cm} p{4cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{init} & \code{container}, \code{width}, \code{height} & drawing stage & \code{ContainerNotFound} \\
\hline
\code{getLayers} & - & array of the layers & - \\
\hline
\code{getContext} & - & drawing context \cite{html_std_canvas} & - \\
\hline
\code{getContainer} & - & display control / container & - \\
\hline
\code{toCanvas} & - & canvasAPI object \cite{html_std_canvas} & - \\
\hline
\code{toDataURL} & - & a URL to an exported image \cite{html_std_canvas} & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}
Currently, using the implementing by the Konva \cite{konva_2021} javascript library.
Largely wraps around the HTML Canvas API object with added functionality such as layering
and ``transformers'' for node-editable shapes.

\subsubsection{State Variables}
\begin{itemize}
  \item width/height: the width and height of the drawing stage in pixels.
  \item Layers: drawing layers
  \item Container: the display control / container where to ``paint'' the images
    as provided by the GUI \mreff{M_GUI}.
  \item Event handlers: all the Konva objects (layers, geometries, stage) may
    have event handlers for HID events.
\end{itemize}

\subsubsection{Environment Variables}
The HIDs and the screen.

\subsubsection{Assumptions}
Any drawing exceptions will result in throwing errors that may be caught as needed,
but will simply result in blank (or black) images with no interruption in any
drawings in progress or drawing loops.

\subsubsection{Access Routine Semantics}

\noindent \code{init()}:
\begin{itemize}
\item transition: Initializes a drawing stage object with the given options where \code{container}
  is the control or location given by the GUI \mreff{M_GUI}.
\item output: the drawing stage object.
\item exception: \code{ContainerNotFound} meaning the given control is nonexistent or could not be found.
\end{itemize}

\noindent \code{getLayers()}:
\begin{itemize}
\item output: an array of all the individual drawing layers within the stage.
\end{itemize}

\noindent \code{getContext()}:
\begin{itemize}
\item output: the drawing context as defined by the CanvasAPI \cite{html_std_canvas}.
\end{itemize}

\noindent \code{getContainer()}:
\begin{itemize}
\item output: the display container as defined/given by the GUI \mreff{M_GUI} when the stage is initialized.
\end{itemize}

\noindent \code{toCanvas()}:
\begin{itemize}
\item output: the canvasAPI element / object \cite{html_std_canvas}.
\end{itemize}

\noindent \code{toDataURL()}:
\begin{itemize}
\item output: a URL pointing to an image exported in-memory within the WebBrowser that can
  ``downloaded'' and saved a location specified by the user.
\end{itemize}

\newpage



\section{MIS of Image Rendering} \label{MS_rendering}

\subsection{Module}
\code{renderUtils} \mrefp{M_rendering}

\subsection{Uses}
Drawing Stage / Canvas \mreff{M_drawStage}

\subsection{Syntax}

\subsubsection{Exported Constants}
\code{defaultLineColor}: the default line color (RGBA) to use for drawing grids (255,255,255,204).

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{4cm} p{4cm} p{4cm} p{3cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{drawGrid} & \code{gridLayer}, \code{rect}, \code{rows}, \code{cols}, \code{lineColor}
  & cell size (width/height in pixels) & \code{badGridParams} \\
\hline
\code{repeatDrawOnGrid} & \code{layer}, \code{rect}, \code{rows}, \code{cols}, \code{shape}
  & - & \code{badGridParams} \\
\hline
\code{ComputeProbeValue\_gs} & \code{image}, \code{probe} & grayscale value ($\mathbb{U}$) & - \\
\hline
\code{get\_avg\_pixel\_gs} & \code{rawImageData} & grayscale value ($\mathbb{U}$) & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
None.

\subsubsection{Environment Variables}
The graphics processing hardware.

\subsubsection{Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent \code{drawGrid(gridLayer, rect, rows, cols, lineColor = defaultLineColor)}:
\begin{itemize}
\item transition: Draws a line (optional colour \code{lineColor}) grid with the specified
  number of \code{rows} and \code{cols} (columns) on the given drawing layer (\code{gridLayer})
  within the given grid rectangular bounds (\code{rect}).
\item output: the computed size in pixel of a cell within the grid drawn.
\item exception: \code{badGridParams} meaning non-integer or non-positive values were given for
  \code{rows} and \code{cols}.
\end{itemize}

\noindent \code{repeatDrawOnGrid(layer, rect, rows, cols, shape)}:
\begin{itemize}
\item transition: Draw a given geometry (\code{shape}) or imageDrawingObject repeated over a grid pattern
  with the specified number of \code{rows} and \code{cols} (columns) on the given drawing
  layer (\code{layer}) within the given grid rectangular bounds (\code{rect}).
\item exception: \code{badGridParams} meaning non-integer or non-positive values were given for
  \code{rows} and \code{cols}.
\end{itemize}

\noindent \code{ComputeProbeValue\_gs(image, probe)}:
\begin{itemize}
\item transition: internally uses \code{get\_avg\_pixel\_gs()} to calculate the pixel value
  of a locally composited or ``stenciled'' or ``clipped'' image (for sampling the region
  defined by the shape or \code{probe}, like a cookie cutter).
  Pixels that have been ``stenciled'' out are set to blank pixels (where all RGBA components are equal to 0)
  and the image is cropped to small rectangular bounding box of the ``stencil'' shape (\code{probe}).
\item output: Gives the average pixel value (grayscale intensity: $\mathbb{U}$) by sampling the given image
  (\code{image}) object with the given shape / geometry (\code{probe}).
\end{itemize}

\noindent \code{get\_avg\_pixel\_gs(rawImageData)}:
\begin{itemize}
  \item output: Gives the average pixel value (grayscale intensity: $\mathbb{U}$) from a given imageData
  array (\code{rawImageData}) of the RGBA pixel values ignoring
  any blank pixels (where all RGBA components are equal to 0).
\end{itemize}

\subsubsection{Local Functions}
None

\newpage



\section{MIS of Image Metrics Calculation} \label{MS_metrics}

\subsection{Module}
\code{metrics} \mrefp{M_metric}

\subsection{Uses}
None

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{5cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{compare} & \code{image1}, \code{image2} & similarity ratio ($\mathbb{A}$) & \code{DifferentImageSizes} \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}
See the SRS \cite{SRS} and MG \cite{MG} for more information.

\subsubsection{State Variables, Environment Variables, and Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent \code{compare(image1, image2)}:
\begin{itemize}
\item transition: Compares the two images and computes a value representing the similarity.
\item output: Gives a value ($\mathbb{A}$) where 1.0 means a perfect match and 0 means zero similarity.
\item exception: \code{DifferentImageSizes} meaning the size of \code{image1} and
  \code{image2} do not match.
\end{itemize}

\subsubsection{Local Functions}
None

\newpage


\section{MIS of Ground Truth Visualization} \label{MS_vizGT}

\subsection{Module}
drawGroundtruthImage \mrefp{M_vizGT}

\subsection{Uses}
Rendering \mreff{M_rendering} and DrawingStage \mreff{M_drawStage}

\subsection{Syntax}

\subsubsection{Exported Constants}
None
\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{drawGroundtruthImage} & \code{stage}, \code{gtImage}, \code{subregionImage}
  & \code{imageDrawingObject} & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
These are kept for mutation, update calls, and performance reasons.
\begin{itemize}
  \item \code{stage}: a reference to drawing stage,
  \item \code{rect}: a reference to a rectangle geometry.
  \item \code{gtImage}: a reference to imageDrawingObject.
  \item \code{subregionImage}: a reference to imageDrawingObject.
\end{itemize}

\subsubsection{Environment Variables and Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent \code{drawGroundtruthImage(stage, gtImage, subregionImage)}:
\begin{itemize}
\item transition: Defines a drawing arrangement to fill the stage with the ground truth image
  (\code{gtImage} as provided by \mref{M_dispControl})
  with a semi-transparent rectangle (\code{rect}) representing the bounds of the
  \code{subregionImage} (as provided by \mref{M_dispControl}).
\item output: an object with a reference to the update function and a reference to \code{rect}.
\end{itemize}

\subsubsection{Local Functions}
\code{doUpdate()}: Update the drawing based on the state variables.

\newpage



\section{MIS of Subregion Visualization} \label{MS_vizSubregion}

\subsection{Module}
drawSubregionImage \mrefp{M_vizSubregion}

\subsection{Uses}
Rendering \mreff{M_rendering} and DrawingStage \mreff{M_drawStage}

\subsection{Syntax}

\subsubsection{Exported Constants}
None
\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{drawSubregionImage} & \code{stage}, \code{gtImage}, \code{updateCallback}
  & \code{subregionImage} & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
These are kept for mutation, update calls, and performance reasons.
\begin{itemize}
  \item \code{stage}: a reference to drawing stage,
  \item \code{subregionImage}: a reference to imageDrawingObject.
  \item \code{updateCallback}: an optional reference to a function call when an update occurs
    (i.e. when view bounds change).
  \item mouse events (scroll and drag)
\end{itemize}

\subsubsection{Environment Variables and Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent \code{drawSubregionImage(stage, gtImage, updateCallback = null)}:
\begin{itemize}
\item transition: Draw a view displaying a copy of the ground truth image
  (\code{gtImage} as provided by \mref{M_dispControl}) representing the current subregion / ROI.
  This view can be panned and zoomed with mouse events.
  The \code{updateCallback} function reference is called when mouse events (drag or scroll)
  causes the of the view bounds to change.
\item output: a reference to \code{subregionImage} imageDrawingObject
  (which can be used like \code{rect}) representing the bounds of the current view.
\end{itemize}

\subsubsection{Local Functions}
\code{doUpdate()}: Update the drawing based on the state variables that change on mouse event
  such as dragging or scrolling events (pan and zoom) and calls the \code{updateCallback}.

\newpage




\section{MIS of Spot Profile Visualization} \label{MS_vizSpotProfile}

\subsection{Module}
drawSpotProfile \mrefp{M_vizSpotProfile}

\subsection{Uses}
Rendering \mreff{M_rendering} and DrawingStage \mreff{M_drawStage}

\subsection{Syntax}

\subsubsection{Exported Constants}
None
\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{5cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{drawSpotProfile} & \code{stage} & \code{beam} & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
These are kept for mutation, update calls, and performance reasons.
\begin{itemize}
  \item \code{stage}: a reference to the drawing stage,
  \item \code{beam}: a reference to the ellipse geometry.
\end{itemize}

\subsubsection{Environment Variables and Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent \code{drawSpotProfile(stage)}:
\begin{itemize}
\item transition: On the given drawing \code{stage},
  draws an editable ellipse shape representing the beam/spot shape.
\item output: a reference to the ellipse geometry (\code{beam}).
\end{itemize}

\subsubsection{Local Functions}
Mouse events handled by Konva for shape node-editing / ``transformers''.

\newpage



\section{MIS of Spot Content Visualization} \label{MS_vizSpotContent}

\subsection{Module}
drawSpotContent \mrefp{M_vizSpotContent}

\subsection{Uses}
Rendering \mreff{M_rendering} and DrawingStage \mreff{M_drawStage}

\subsection{Syntax}

\subsubsection{Exported Constants}
None
\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{4cm} p{5cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
\code{drawSpotContent} & \code{stage}, \code{subregionImage}, \code{sBeam}, \code{updateCallback}
  & \code{sImage} & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}
These are kept for mutation, update calls, and performance reasons.
\begin{itemize}
  \item \code{stage}: a reference to the drawing stage,
  \item \code{sImage}: a reference to the subregion image clone.
  \item \code{sBeam}: a local reference to the beam geometry clone (not changed).
  \item \code{updateCallback}: an optional reference to a function call when an update occurs
  (i.e. when the \code{sImage} position and scaling to changese).
  \item mouse events (scroll and drag)
\end{itemize}

\subsubsection{Environment Variables and Assumptions}
None

\subsubsection{Access Routine Semantics}

\noindent \code{drawSpotContent(stage, subregionImage, sBeam, updateCallback = null)}:
\begin{itemize}
\item transition: On a given drawing stage (\code{stage}),
  draws an image clone (based on \code{subregionImage}) of the subregion (\code{sImage})
  that is ``stenciled'' or clipped by the \code{sBeam} geometry/shape.
  This image can be panned and zoomed by mouse events.
  The \code{updateCallback} function reference is called when mouse events
  (drag or scroll) causes the image (\code{sImage}) position and scaling to changes.
\item output: a reference to the image (\code{sImage}) being moved and scaled.
\end{itemize}

\subsubsection{Local Functions}
\code{doUpdate()}: Update the drawing based on the state variables that change on mouse event
  such as dragging or scrolling events (pan and zoom) and calls the \code{updateCallback}.

\newpage





% ///////////////////////////////////////////////////////////////////////
% //////////////////////////// END MIS ITEMS ////////////////////////////
% ///////////////////////////////////////////////////////////////////////


\bibliographystyle {plainnat}
\bibliography {../../../refs/References,../../../refs/cas741,../../../refs/programming}

\newpage

\end{document}